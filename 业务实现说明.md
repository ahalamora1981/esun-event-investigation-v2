# 业务实现说明

## 系统用途

本系统用于调查交易事件，自动分析事件相关通信记录，识别潜在风险。业务人员可通过 Web 接口提交调查请求，系统自动检索记录、评分评估并返回分析结果。

## 工作流程

### 1. 提交事件信息
准备以下信息：
- **事件名称**：如 "230205（23 国开 205）"
- **事件时间**：事件发生的准确时间（格式：2026-01-19T14:00:00）
- **内部人员**：参与事件的内部员工 ID 列表
- **外部人员**：相关外部人员姓名列表
- **相关性阈值**：0-100 之间的数值，只保留得分高于此值的记录
- **评分权重**：时间、用户、内容三个维度的权重（总和必须为 100）
- **是否进行风险评估**：选择是否使用 AI 分析记录风险

### 2. 系统自动检索
系统自动获取以下通信记录：
- 通话录音
- 邮件往来
- QTrade 聊天记录
- Ideal 聊天记录

### 3. 智能评分筛选
系统从三个维度评估每条记录：

| 评分维度 | 说明 |
|---------|------|
| 时间相关性 | 记录时间与事件时间越近，得分越高 |
| 用户相关性 | 匹配内部员工 ID 和外部人员姓名 |
| 内容相关性 | 分析记录内容与事件名称的关联度 |

按设置的权重计算综合得分，保留得分高于相关性阈值的记录。

### 4. 风险评估（可选）
如果选择进行风险评估，系统会对每条记录自动分析：
- **风险等级**：高 / 中 / 低
- **风险描述**：说明风险类型（信息泄露、价格引导、跨方协调）及影响

### 5. 结果输出
返回事件信息和相关记录列表，包含评分和风险评估。

## 使用指南

### 通过接口提交查询

**请求示例：**
```json
POST http://服务器地址:8000/reconstruct
{
  "event_name": "230205（23 国开 205）",
  "event_time": "2026-01-19T14:00:00",
  "internal_users": ["1772917751770292225"],
  "external_users": ["韩梅梅", "周子航"],
  "relevance": 50,
  "weights": {
    "time": 30,
    "user": 30,
    "content": 40
  },
  "ai_check_record": true
}
```

**字段说明：**
| 字段 | 说明 |
|-----|------|
| event_name | 事件名称 |
| event_time | 事件时间（格式：YYYY-MM-DDTHH:MM:SS） |
| internal_users | 内部员工 ID 列表 |
| external_users | 外部人员姓名列表 |
| relevance | 相关性阈值（0-100），只保留得分≥此值的记录 |
| weights.time | 时间权重（0-100） |
| weights.user | 用户权重（0-100） |
| weights.content | 内容权重（0-100） |
| ai_check_record | 是否进行风险评估（true/false） |

**返回结果：**
| 字段 | 说明 |
|-----|------|
| 事件名称 | 被调查的事件名称 |
| 事件时间 | 事件发生时间 |
| 内部用户 | 内部员工姓名 |
| 外部用户 | 外部人员姓名 |
| 时间相关性 | 时间维度评分（0-100） |
| 用户相关性 | 用户维度评分（0-100） |
| 内容相关性 | 内容维度评分（0-100） |
| 综合得分 | 综合评分（0-100） |
| 风险等级 | 高 / 中 / 低（仅当 ai_check_record 为 true 时返回） |
| 风险描述 | 风险详情（仅当 ai_check_record 为 true 时返回） |

### 结果解读

**综合得分：**
- 90-100 分：高度相关，重点关注
- 70-89 分：较相关，建议查看
- 50-69 分：可能相关，作为参考

**风险等级：**
- **高**：存在严重风险，需立即关注
- **中**：存在一定风险，需进一步确认
- **低**：风险较低，但仍需关注

## 应用场景

- **交易异常调查**：快速定位异常沟通或违规行为
- **合规审查**：定期检查关键交易的通信记录
- **风险监控**：跟踪高风险事件的沟通情况
